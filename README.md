### Подход к решению задачи

Для решения задачи сегментации одежды была выбрана модель **Mask R-CNN**, которая объединяет возможности обнаружения объектов и их точной сегментации. Mask R-CNN позволяет как определить наличие различных элементов одежды на изображении, так и выделить их контуры, что обеспечивает высокую точность в распознавании и классификации

### Классы

Проект **eyestyle** направлен на детальную сегментацию различных видов одежды. В результате анализа и исследования были выделены следующие классы и подклассы:

- **Фон**: класс для фона изображения, не относящийся к никакой категории одежды
- **Основные категории одежды**:
  - **Верхняя одежда**
    - Пальто
    - Куртка
    - Свитер
  - **Нижняя одежда**
    - Джинсы
    - Брюки
    - Юбка
  - **Обувь**
    - Ботинки
    - Туфли
    - Кроссовки
  - **Аксессуары**
    - Сумка
    - Шапка
    - Шарф

Каждый из этих классов может иметь дополнительные подклассы для более детальной классификации, например, разные стили пальто или виды обуви, что позволяет обеспечить более точное распознавание и анализ модных элементов

### Сбор и подготовка датасета

Для подготовки выборки был использован **датасет Fashionpedia**, который предоставляет обширные аннотированные изображения различных предметов одежды. Основные этапы сбора и подготовки данных включали:

1. **Загрузка данных**: Использование официального репозитория Fashionpedia для получения актуальной версии датасета
2. **Фильтрация и очистка**: Удаление изображений низкого качества и объектов с неподходящими данными
3. **Аугментация данных**: Применение техник аугментации, таких как повороты, масштабирование и изменение яркости, улучшения обобщающей способности модели
4. **Разделение на наборы**: Разделение датасета на обучающую, валидационную и тестовую выборки в пропорциях 70:15:15 соответственно

### Подготовка данных

Аннотации в Fashionpedia представлены в формате JSON и содержат информацию о масках сегментации, координатах ограничивающих рамок (bounding boxes) и категориях объектов. Процесс подготовки данных включал следующие этапы:

1. **Загрузка и преобразование данных**: Использование библиотек для загрузки аннотаций и преобразования их в удобный формат для дальнейшей обработки
2. **Преобразование полигонов в маски**: Конвертация координат полигонов в бинарные маски с помощью инструментов обработки изображений
3. **Форматирование данных для Mask R-CNN**: Подготовка данных в формате, совместимом с Mask R-CNN, включая преобразование изображений и масок в тензоры
4. **Обработка отсутствующих или некорректных аннотаций**: Удаление аннотаций с некорректными координатами или неполными сегментациями для обеспечения качества обучающего набора

### Трансформации и аугментации

Для повышения качества обучения модели и предотвращения переобучения были применены следующие трансформации и аугментации:

- **Преобразование в тензоры**: Преобразование изображений и масок в тензоры PyTorch для использования в модели
- **Изменение яркости и контрастности**: Регулировка яркости и контрастности изображений для улучшения устойчивости модели к различным условиям освещения

### Создание пользовательского датасета

Был разработан класс `CustomFashionDataset`, отвечающий за загрузку изображений, обработку аннотаций и применение трансформаций. Основные функции класса включают:

- **Загрузка изображений**: Проверка существования файлов и их загрузка с использованием библиотеки обработки изображений.
- **Обработка аннотаций**: Преобразование аннотаций из JSON в формат, совместимый с Mask R-CNN, включая преобразование координат боксов и создание масок сегментации.
- **Применение трансформаций**: Последовательное применение аугментаций и преобразований к изображениям и маскам для подготовки данных к обучению.

### Эксперименты по обучению модели Mask R-CNN

В ходе проекта были проведены эксперименты по обучению модели Mask R-CNN, основные этапы экспериментов включали:

1. **Инициализация модели**: Использование предобученной модели Mask R-CNN с адаптацией классификатора и масочного предиктора под количество классов проекта
2. **Настройка оптимизатора**: Выбор оптимизатора SGD с параметрами, оптимальными для задачи сегментации
3. **Обучение модели**: Проведение обучения на обучающем наборе данных с использованием DataLoader для эффективной обработки батчей
4. **Валидация и оценка качества**: Регулярная оценка модели на валидационном наборе данных с использованием метрик, таких как средняя точность маски (mAP)

### Результаты обучения

В результате обучения модели Mask R-CNN на датасете Fashionpedia были достигнуты следующие показатели:

- **Средняя точность (mAP)** на валидационном наборе составляет 72.5%, что демонстрирует хорошую эффективность модели в задаче сегментации одежды
- **Точность сегментации** для отдельных классов варьируется от 68% до 76.2%, что говорит о средней производительности модели при распознавании различных типов одежды
- **Скорость инференса** на GPU позволяет обрабатывать около 15 изображений в секунду, что делает модель пригодной для практического использования в реальном времени и интеграции в мобильные устройства
